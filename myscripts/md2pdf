#!/bin/bash

# Check if exactly two arguments are provided
if [ $# -ne 2 ]; then
    echo "Usage: $0 input.md output.pdf"
    exit 1
fi

# Assign arguments to variables
input_file="$1"
output_file="$2"

# Check if input file exists
if [ ! -f "$input_file" ]; then
    echo "Error: Input file '$input_file' does not exist"
    exit 1
fi

# Check if input file has .md extension
if [[ ! "$input_file" =~ \.md$ ]]; then
    echo "Error: Input file must have .md extension"
    exit 1
fi

# Check if output file has .pdf extension
if [[ ! "$output_file" =~ \.pdf$ ]]; then
    echo "Error: Output file must have .pdf extension"
    exit 1
fi

# Check if output file already exists
if [ -f "$output_file" ]; then
    read -p "Output file '$output_file' already exists. Overwrite? (y/n): " answer
    if [[ ! "$answer" =~ ^[Yy]$ ]]; then
        echo "Aborted"
        exit 0
    fi
fi

# Extract filename without extension for metadata title
filename=$(basename "$input_file" .md)

# Ask user for title preference
read -p "Use filename '$filename' as title? (y/n, n for empty title): " title_answer
if [[ ! "$title_answer" =~ ^[Yy]$ ]]; then
    filename=" "
fi

# Convert markdown to PDF using pandoc
# pdflatex is a more complex engine good for math formulae
# wkhtmltopdf is a WebKit based engine good for web layouts
#pandoc "$input_file" -o "$output_file" --pdf-engine=pdflatex ---metadata=title:"$filename"
pandoc "$input_file" -o "$output_file" --pdf-engine=wkhtmltopdf --metadata=title:"$filename"

# Check if conversion was successful
if [ $? -eq 0 ]; then
    echo "Successfully converted '$input_file' to '$output_file'"
else
    echo "Error: Conversion failed"
    exit 1
fi
